<?php

namespace App\Shared;

class ScanReport
{

    public ?string $startTime = null;
    public ?string $endTime = null;
    public ?string $directory = null;
    public ?int $totalFilesScanned = null;
    public ?int $totalMalwareIdentified = null;


    public static function fromScannerOutput(array $outputLines): ScanReport
    {

        $reportLines = [
            '/Start time: (.+)$/' => 'startTime',
            '/End time: (.+)$/' => 'endTime',
            '/Base directory: (.+)$/' => 'directory',
            '/Total files scanned: (\d+)$/' => 'totalFilesScanned',
            '/Total malware identified: (\d+)$/' => 'totalMalwareIdentified',
        ];

        $report = new ScanReport();

        foreach ($reportLines as $regex => $mapping) {
            foreach ($outputLines as $line) {
                if (preg_match($regex, $line, $matches)) {
                    $report->$mapping = $matches[1];
                }
            }
        }

        return $report;
    }

}
