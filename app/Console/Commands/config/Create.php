<?php

namespace App\Console\Commands\config;


use ErrorException;


class Create extends AbstractConfigCommand
{

    public $signature = 'config:create {--email-driver=smtp} {--emails=} {--directories=} {--excludes=}';

    /**
     * @throws ErrorException
     */
    public function handle(): int
    {

        $mailConfigVars = [
            'ses' => [
                'AWS_ACCESS_KEY_ID' => config('services.sess.key'),
                'AWS_SECRET_ACCESS_KEY' => '***********',
                'AWS_DEFAULT_REGION' => config('services.ses.region'),
            ],
            'smtp' => [
                'MAIL_HOST' => config('mail.mailers.smtp.host'),
                'MAIL_PORT' => config('mail.mailers.smtp.port'),
                'MAIL_ENCRYPTION' => config('mail.mailers.smtp.encryption'),
                'MAIL_USERNAME' => config('mail.mailers.smtp.username'),
                'MAIL_PASSWORD' => config('mail.mailers.smtp.password'),
            ],
        ];

        $mailDriver = $this->askWithCompletion('Mail driver', array_keys($mailConfigVars), $this->option('email-driver'));
        $this->setInDotenv('MAIL_MAILER', $mailDriver);

        if ($mailDriverVars = $mailConfigVars[$mailDriver]) {
            foreach ($mailDriverVars as $envName => $currentValue) {
                $newEnvValue = $this->ask($envName, $currentValue ?? '');
                $this->setInDotenv($envName, $newEnvValue);
            }
        }

        $this->askOptionOrConfig('emails', 'report-emails.txt', 'Emails list, comma-separated');
        $this->askOptionOrConfig('directories', 'directories.txt', 'Scan directories list, comma-separated');
        $this->askOptionOrConfig('excludes', 'excludes.txt', 'Exclude list, comma-separated');


        return 0;
    }


}
