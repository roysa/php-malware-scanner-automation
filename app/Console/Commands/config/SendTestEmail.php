<?php

namespace App\Console\Commands\config;

use Illuminate\Support\Facades\Mail;

class SendTestEmail extends AbstractConfigCommand
{


    public $signature = 'config:send-test-email {--email=}';

    public function handle(): int
    {

        $emails = $this->readCommaSeparatedOption('email');

        $configEmails = $this->readScannerConfig('report-emails.txt');

        if (!$configEmails) {
            $this->warn('WARN: no emails addresses are set in config');
        }

        if (!$emails) {
            $emails = $configEmails;
            if (!$emails) {
                $this->error('At least one email address is required');
                return 1;
            }
        }

        foreach ($emails as $emailTo) {
            $this->line("Sending to {$emailTo}...\n");

//            Mail::alwaysFrom('', config('app.name'));

            Mail::send('email.test', [], function($message) use ($emailTo)
            {
                $message
                    ->to($emailTo, $emailTo)
                    ->subject('Test email from PHP Malware Scanner!');
            });
        }

        $this->info('All done');

        return 0;
    }

}
